@model GroceryManagement.Models.FinanceInvoicesVM
@{
    ViewBag.Title = "Invoices";
}

<h2>Invoices</h2>

<form id="invoiceFilter">
    <input type="text" name="search" placeholder="Search by id/customer/supplier" />
    <select name="sort">
        <option value="date">Date</option>
        <option value="total">Total</option>
    </select>
    <select name="dir">
        <option value="desc">Desc</option>
        <option value="asc">Asc</option>
    </select>
    <button type="submit">Apply</button>
</form>

<div id="invoiceTable">
    @await Html.PartialAsync("_InvoicesTable", Model)
</div>

<script>
    (function(){
        const form = document.getElementById('invoiceFilter');
        const container = document.getElementById('invoiceTable');

        function load(page){
            const data = new URLSearchParams(new FormData(form));
            if(page) data.set('page', page);
            fetch('/Finance/InvoicesPartial?' + data.toString(), { headers: { 'X-Requested-With':'XMLHttpRequest' }})
                .then(r => r.text())
                .then(html => container.innerHTML = html);
        }

        form.addEventListener('submit', e => { e.preventDefault(); load(1); });
        container.addEventListener('click', e => {
            if(e.target.matches('[data-page]')){ e.preventDefault(); load(e.target.getAttribute('data-page')); }
            if(e.target.matches('[data-sort]')){ e.preventDefault(); form.sort.value = e.target.getAttribute('data-sort'); form.dir.value = form.dir.value==='asc'?'desc':'asc'; load(1); }
        });
    })();
</script>
