@model ProductUpdateVM

@{
    ViewBag.Title = "Product | Update";
}

<form method="post" class="form" enctype="multipart/form-data">
    <div asp-validation-summary="ModelOnly"></div>

    <input asp-for="Id" hidden />
    <input asp-for="PhotoURL" hidden />

    <label asp-for="Id"></label>
    <b>@Model.Id</b>
    <br />

    <label asp-for="Name"></label>
    <input asp-for="Name" data-upper autofocus>
    <span asp-validation-for="Name"></span>

    <label asp-for="SellPrice"></label>
    <input asp-for="SellPrice" type="number" step="0.01">
    <span asp-validation-for="SellPrice"></span>

    <label asp-for="Photo">Photo</label>
    <label class="upload">

        <input asp-for="Photo" accept="image/jpeg,image/png" hidden onchange="previewFile(this)">
        <img src="/images/productImg/@Model.PhotoURL" id="previewImage" style="transition: transform 0.3s ease;">
    </label>

    <div style="margin-top: 10px; padding: 10px; border: 1px solid #ddd; background-color: #f9f9f9;">
        <strong>Advanced Image Options:</strong>
        <span>Rotate:</span>
        <label style="margin-right: 10px;">
            <input type="radio" name="Direction" value="None" checked> None
        </label>
        <label style="margin-right: 10px;">
            <input type="radio" name="Direction" value="Left"> ↺ Left
        </label>
        <label>
            <input type="radio" name="Direction" value="Right"> ↻ Right
        </label>
        <label style="margin-top: 5px; display:block;">
            <input type="checkbox" name="Flip" value="true"> ↔ Flip Horizontally
        </label>
        <span asp-validation-for="Photo"></span>
    </div>
    

    <label asp-for="Category"></label>
    <input asp-for="Category" list="categoryOptions" placeholder="Select or type new..." autocomplete="off" data-upper>
    <span asp-validation-for="Category"></span>

    <datalist id="categoryOptions">
        @foreach (var cat in ViewBag.ProductList)
        {
            <option value="@cat"></option>
        }
    </datalist>

    <label asp-for="WareHouseQty">Warehouse Qty</label>
    <input asp-for="WareHouseQty" type="number" min="0">
    <span asp-validation-for="WareHouseQty"></span>

    <label asp-for="StoreFrontQty">Store Front Qty</label>
    <input asp-for="StoreFrontQty" type="number" min="0">
    <span asp-validation-for="StoreFrontQty"></span>

    <section>
        <button>Update</button>
        <button type="reset">Reset</button>
    </section>
</form>
@section Scripts {
    <script>
        function previewFile(input) {
            var file = input.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function () {
                    $("#previewImage").attr("src", reader.result);
                    // Reset rotation when a new file is chosen
                    currentRotation = 0;
                    applyRotation();
                    // Reset radio buttons to 'None'
                    $("input[name='Direction'][value='None']").prop("checked", true);
                }
                reader.readAsDataURL(file);
            }
        }

        var currentRotation = 0;

        $(document).ready(function () {
            $('input[name="Direction"]').change(function () {
                var val = $(this).val();
                if (val === "Left") currentRotation = -90;
                else if (val === "Right") currentRotation = 90;
                else currentRotation = 0;

                applyRotation();
            });

            $('input[name="Flip"]').change(function () {
                applyRotation();
            });
        });

        function applyRotation() {
            var flipVal = $('input[name="Flip"]').is(':checked') ? "scaleX(-1)" : "scaleX(1)";
            $("#previewImage").css("transform", `rotate(${currentRotation}deg) ${flipVal}`);
        }
    </script>
}